<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Color Pop Frenzy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .pulse-animation {
            animation: pulse 1.5s infinite;
        }
        .game-tile {
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .game-tile:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }
        .color-blind {
            filter: contrast(1.2) saturate(1.5);
        }
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f00;
            border-radius: 50%;
            animation: fall 3s linear forwards;
        }
        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <div class="container mx-auto px-4 py-6 max-w-md">
        <!-- Game Header -->
        <header class="flex justify-between items-center mb-6">
            <div class="flex items-center">
                <i class="fas fa-palette text-3xl text-purple-600 mr-2"></i>
                <h1 class="text-2xl font-bold text-gray-800">Color Pop Frenzy</h1>
            </div>
            <div id="score-display" class="bg-white rounded-full px-4 py-2 shadow-md">
                <span class="font-bold text-purple-600">Score: </span>
                <span id="score" class="font-bold">0</span>
            </div>
        </header>

        <!-- Game Board -->
        <div id="game-board" class="grid grid-cols-4 gap-3 mb-6">
            <!-- Tiles will be generated by JavaScript -->
        </div>

        <!-- Game Controls -->
        <div class="bg-white rounded-xl p-4 shadow-lg mb-6">
            <div class="flex justify-between mb-4">
                <button id="hint-btn" class="bg-yellow-400 hover:bg-yellow-500 text-white font-bold py-2 px-4 rounded-full transition">
                    <i class="fas fa-lightbulb mr-2"></i>Hint
                </button>
                <button id="color-blind-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-full transition">
                    <i class="fas fa-eye mr-2"></i>Color Mode
                </button>
            </div>
            <div class="text-center">
                <button id="target-color" class="text-2xl font-bold py-3 px-6 rounded-full shadow-md text-white">
                    Match This Color!
                </button>
            </div>
        </div>

        <!-- Game Stats -->
        <div class="bg-white rounded-xl p-4 shadow-lg mb-6">
            <div class="grid grid-cols-3 gap-2 text-center">
                <div>
                    <div class="text-sm text-gray-500">Level</div>
                    <div id="level" class="text-xl font-bold text-purple-600">1</div>
                </div>
                <div>
                    <div class="text-sm text-gray-500">Streak</div>
                    <div id="streak" class="text-xl font-bold text-green-500">0</div>
                </div>
                <div>
                    <div class="text-sm text-gray-500">Time</div>
                    <div id="time" class="text-xl font-bold text-red-500">60</div>
                </div>
            </div>
        </div>

        <!-- Game Messages -->
        <div id="message" class="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white p-6 rounded-xl shadow-xl z-50 hidden">
            <h2 class="text-2xl font-bold mb-4 text-center"></h2>
            <p class="text-center mb-4"></p>
            <button class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-full transition">
                Continue
            </button>
        </div>
    </div>

    <script>
        // Game State
        const gameState = {
            score: 0,
            level: 1,
            streak: 0,
            timeLeft: 60,
            targetColor: null,
            colorBlindMode: false,
            gameActive: false,
            timer: null,
            aiDifficulty: 1,
            colors: [
                '#FF5733', '#33FF57', '#3357FF', '#F3FF33', 
                '#FF33F3', '#33FFF3', '#FF8C33', '#8C33FF',
                '#33FF8C', '#FF338C', '#338CFF', '#8CFF33'
            ],
            colorNames: [
                'Red Orange', 'Green', 'Blue', 'Yellow',
                'Pink', 'Cyan', 'Orange', 'Purple',
                'Mint', 'Magenta', 'Royal Blue', 'Lime'
            ],
            currentTiles: []
        };

        // DOM Elements
        const gameBoard = document.getElementById('game-board');
        const scoreDisplay = document.getElementById('score');
        const levelDisplay = document.getElementById('level');
        const streakDisplay = document.getElementById('streak');
        const timeDisplay = document.getElementById('time');
        const targetColorBtn = document.getElementById('target-color');
        const hintBtn = document.getElementById('hint-btn');
        const colorBlindBtn = document.getElementById('color-blind-btn');
        const messageBox = document.getElementById('message');
        const messageTitle = messageBox.querySelector('h2');
        const messageText = messageBox.querySelector('p');
        const messageBtn = messageBox.querySelector('button');

        // Initialize Game
        function initGame() {
            gameState.score = 0;
            gameState.level = 1;
            gameState.streak = 0;
            gameState.timeLeft = 60;
            gameState.aiDifficulty = 1;
            gameState.gameActive = true;
            
            updateDisplays();
            generateLevel();
            startTimer();
        }

        // Generate Level with AI elements
        function generateLevel() {
            gameBoard.innerHTML = '';
            gameState.currentTiles = [];
            
            // AI determines target color and similar colors
            const targetIndex = Math.floor(Math.random() * gameState.colors.length);
            gameState.targetColor = gameState.colors[targetIndex];
            targetColorBtn.style.backgroundColor = gameState.targetColor;
            targetColorBtn.textContent = `Match ${gameState.colorNames[targetIndex]}`;
            
            // AI determines difficulty-based color variations
            const similarColors = generateSimilarColors(gameState.targetColor, gameState.level);
            
            // Create tiles
            const tileCount = 4 + Math.min(Math.floor(gameState.level / 3), 4); // 4-8 tiles based on level
            const targetPosition = Math.floor(Math.random() * tileCount);
            
            for (let i = 0; i < tileCount; i++) {
                const tile = document.createElement('div');
                tile.className = 'game-tile aspect-square rounded-xl cursor-pointer flex items-center justify-center text-white font-bold text-xl';
                
                if (i === targetPosition) {
                    tile.style.backgroundColor = gameState.targetColor;
                    tile.dataset.correct = 'true';
                } else {
                    // AI selects a similar color based on difficulty
                    const similarColor = similarColors[Math.floor(Math.random() * similarColors.length)];
                    tile.style.backgroundColor = similarColor;
                    tile.dataset.correct = 'false';
                }
                
                tile.addEventListener('click', handleTileClick);
                gameBoard.appendChild(tile);
                gameState.currentTiles.push(tile);
            }
            
            // Adjust grid columns based on tile count
            if (tileCount > 4) {
                gameBoard.className = 'grid grid-cols-4 gap-3 mb-6';
                if (tileCount > 6) {
                    gameBoard.className = 'grid grid-cols-4 gap-2 mb-6';
                }
            } else {
                gameBoard.className = 'grid grid-cols-2 gap-4 mb-6';
            }
        }

        // AI generates similar colors based on difficulty
        function generateSimilarColors(baseColor, level) {
            const similarColors = [];
            const baseRgb = hexToRgb(baseColor);
            
            // Adjust similarity based on level (higher level = more similar colors)
            const similarityFactor = Math.max(0.1, 0.7 - (level * 0.03));
            
            for (let i = 0; i < 5; i++) {
                const r = Math.floor(baseRgb.r + (Math.random() * 100 * similarityFactor - 50 * similarityFactor));
                const g = Math.floor(baseRgb.r + (Math.random() * 100 * similarityFactor - 50 * similarityFactor));
                const b = Math.floor(baseRgb.r + (Math.random() * 100 * similarityFactor - 50 * similarityFactor));
                
                similarColors.push(rgbToHex(
                    Math.min(255, Math.max(0, r)),
                    Math.min(255, Math.max(0, g)),
                    Math.min(255, Math.max(0, b))
                ));
            }
            
            // Add some completely random colors to make it harder
            if (level > 5) {
                similarColors.push(gameState.colors[Math.floor(Math.random() * gameState.colors.length)]);
            }
            
            return similarColors;
        }

        // Helper functions for color manipulation
        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : null;
        }

        function rgbToHex(r, g, b) {
            return '#' + [r, g, b].map(x => {
                const hex = x.toString(16);
                return hex.length === 1 ? '0' + hex : hex;
            }).join('');
        }

        // Handle tile clicks
        function handleTileClick(e) {
            if (!gameState.gameActive) return;
            
            const tile = e.currentTarget;
            
            if (tile.dataset.correct === 'true') {
                // Correct selection
                gameState.score += 10 + (gameState.streak * 2);
                gameState.streak++;
                
                if (gameState.streak % 5 === 0) {
                    gameState.timeLeft += 5; // Bonus time for streaks
                }
                
                // Visual feedback
                tile.classList.add('pulse-animation');
                setTimeout(() => {
                    tile.classList.remove('pulse-animation');
                    createConfetti(tile);
                    nextLevel();
                }, 500);
            } else {
                // Wrong selection
                gameState.streak = 0;
                gameState.timeLeft = Math.max(5, gameState.timeLeft - 3); // Penalty time
                
                // Visual feedback
                tile.classList.add('animate-ping');
                setTimeout(() => {
                    tile.classList.remove('animate-ping');
                }, 500);
            }
            
            updateDisplays();
        }

        // Move to next level
        function nextLevel() {
            gameState.level++;
            
            // AI adjusts difficulty
            gameState.aiDifficulty = 1 + (gameState.level * 0.1);
            
            // Show level up message
            if (gameState.level % 5 === 0) {
                showMessage(`Level ${gameState.level}!`, `Great job! Colors are getting trickier now.`);
            } else {
                setTimeout(generateLevel, 500);
            }
            
            updateDisplays();
        }

        // Create confetti effect
        function createConfetti(element) {
            const rect = element.getBoundingClientRect();
            const colors = ['#FF5733', '#33FF57', '#3357FF', '#F3FF33', '#FF33F3'];
            
            for (let i = 0; i < 20; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = `${rect.left + rect.width/2}px`;
                confetti.style.top = `${rect.top + rect.height/2}px`;
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                document.body.appendChild(confetti);
                
                // Random direction
                confetti.style.setProperty('--x', (Math.random() - 0.5) * 200);
                
                // Remove after animation
                setTimeout(() => {
                    confetti.remove();
                }, 3000);
            }
        }

        // Update all displays
        function updateDisplays() {
            scoreDisplay.textContent = gameState.score;
            levelDisplay.textContent = gameState.level;
            streakDisplay.textContent = gameState.streak;
            timeDisplay.textContent = gameState.timeLeft;
            
            // Color streak display based on streak count
            if (gameState.streak >= 5) {
                streakDisplay.classList.remove('text-green-500');
                streakDisplay.classList.add('text-yellow-500');
            } else {
                streakDisplay.classList.remove('text-yellow-500');
                streakDisplay.classList.add('text-green-500');
            }
        }

        // Timer function
        function startTimer() {
            if (gameState.timer) clearInterval(gameState.timer);
            
            gameState.timer = setInterval(() => {
                gameState.timeLeft--;
                timeDisplay.textContent = gameState.timeLeft;
                
                if (gameState.timeLeft <= 10) {
                    timeDisplay.classList.add('animate-pulse');
                } else {
                    timeDisplay.classList.remove('animate-pulse');
                }
                
                if (gameState.timeLeft <= 0) {
                    endGame();
                }
            }, 1000);
        }

        // End game
        function endGame() {
            clearInterval(gameState.timer);
            gameState.gameActive = false;
            
            showMessage(
                'Game Over!', 
                `Your final score: ${gameState.score}\nLevel reached: ${gameState.level}`,
                'Play Again'
            );
        }

        // Show message box
        function showMessage(title, text, btnText = 'OK') {
            messageTitle.textContent = title;
            messageText.textContent = text;
            messageBtn.textContent = btnText;
            messageBox.classList.remove('hidden');
            
            // Center message box
            messageBox.style.top = `${window.scrollY + window.innerHeight/2}px`;
            
            // Handle button click
            messageBtn.onclick = () => {
                messageBox.classList.add('hidden');
                if (btnText === 'Play Again') {
                    initGame();
                }
            };
        }

        // Hint button
        hintBtn.addEventListener('click', () => {
            if (!gameState.gameActive) return;
            
            // Find correct tile
            const correctTile = gameState.currentTiles.find(tile => tile.dataset.correct === 'true');
            
            if (correctTile) {
                // Flash the correct tile
                correctTile.classList.add('ring-4', 'ring-white', 'ring-opacity-90');
                setTimeout(() => {
                    correctTile.classList.remove('ring-4', 'ring-white', 'ring-opacity-90');
                }, 1000);
                
                // Deduct points for using hint
                gameState.score = Math.max(0, gameState.score - 5);
                updateDisplays();
            }
        });

        // Color blind mode
        colorBlindBtn.addEventListener('click', () => {
            gameState.colorBlindMode = !gameState.colorBlindMode;
            
            if (gameState.colorBlindMode) {
                colorBlindBtn.innerHTML = '<i class="fas fa-eye-slash mr-2"></i>Normal Mode';
                document.body.classList.add('color-blind');
            } else {
                colorBlindBtn.innerHTML = '<i class="fas fa-eye mr-2"></i>Color Mode';
                document.body.classList.remove('color-blind');
            }
        });

        // Start the game when clicking the target color (initial start)
        targetColorBtn.addEventListener('click', () => {
            if (!gameState.gameActive) {
                initGame();
            }
        });

        // Initial setup
        targetColorBtn.style.backgroundColor = '#8C33FF';
        showMessage(
            'Color Pop Frenzy', 
            'Match the center color by tapping the matching tile. Be quick and build streaks for bonus points!',
            'Start Game'
        );
    </script>
</body>
</html>